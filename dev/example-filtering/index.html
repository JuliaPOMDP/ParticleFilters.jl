<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Example: Filtering Preexisting Data · ParticleFilters.jl</title><meta name="title" content="Example: Filtering Preexisting Data · ParticleFilters.jl"/><meta property="og:title" content="Example: Filtering Preexisting Data · ParticleFilters.jl"/><meta property="twitter:title" content="Example: Filtering Preexisting Data · ParticleFilters.jl"/><meta name="description" content="Documentation for ParticleFilters.jl."/><meta property="og:description" content="Documentation for ParticleFilters.jl."/><meta property="twitter:description" content="Documentation for ParticleFilters.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ParticleFilters.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../bootstrap/">Bootstrap Filter</a></li><li><a class="tocitem" href="../beliefs/">Beliefs</a></li><li><a class="tocitem" href="../basic/">Basic Particle Filter</a></li><li><a class="tocitem" href="../depletion/">Handling Particle Depletion</a></li><li><a class="tocitem" href="../sampling/">Sampling</a></li><li class="is-active"><a class="tocitem" href>Example: Filtering Preexisting Data</a><ul class="internal"><li><a class="tocitem" href="#Model"><span>Model</span></a></li><li><a class="tocitem" href="#Data"><span>Data</span></a></li><li><a class="tocitem" href="#Filtering"><span>Filtering</span></a></li><li><a class="tocitem" href="#Plotting-the-Results"><span>Plotting the Results</span></a></li><li><a class="tocitem" href="#Appendix"><span>Appendix</span></a></li></ul></li><li><a class="tocitem" href="../example-feedback/">Example: Feedback Control</a></li><li><a class="tocitem" href="../example-pomdps/">Example: Use with POMDPs.jl</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Example: Filtering Preexisting Data</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Example: Filtering Preexisting Data</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaPOMDP/ParticleFilters.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaPOMDP/ParticleFilters.jl/blob/master/docs/src/example-filtering.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Example:-Filtering-Preexisting-Data"><a class="docs-heading-anchor" href="#Example:-Filtering-Preexisting-Data">Example: Filtering Preexisting Data</a><a id="Example:-Filtering-Preexisting-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-Filtering-Preexisting-Data" title="Permalink"></a></h1><p>In some cases, there is no need to perform control based on the particle belief and instead the goal is to filter a previously-generated sequence of measurements to remove noise or reconstruct hidden state variables. This tutorial will illustrate use of the <code>runfilter</code> function for that purpose.</p><p>First, we import the packages we will use. </p><pre><code class="language-julia hljs">using Distributions
using Random
using DelimitedFiles
using ParticleFilters
using VegaLite</code></pre><h2 id="Model"><a class="docs-heading-anchor" href="#Model">Model</a><a id="Model-1"></a><a class="docs-heading-anchor-permalink" href="#Model" title="Permalink"></a></h2><p>We will use <a href="https://en.wikipedia.org/wiki/Euler_method">Euler-integrated</a> <a href="https://en.wikipedia.org/wiki/Van_der_Pol_oscillator">Van Der Pol Oscillator Equations</a> with noise added as the dynamics (<code>f</code>), and measurements of the position with gaussian noise added (the pdf is encoded in <code>g</code>).</p><p>This model is implemented below. For more information on defining models for particle filters, see the <a href="https://juliapomdp.github.io/ParticleFilters.jl/latest/models/">documentation</a>.</p><pre><code class="language-julia hljs">const dt = 0.2
const mu = 0.8
const sigma = 1.0

function f(x, u, rng)
    xdot = [x[2], mu * (1 - x[1]^2) * x[2] - x[1] + u + 0.1 * randn(rng)]
    return x + dt * xdot
end

g(x1, u, x2, y) = pdf(Normal(sigma), y - x2[1])</code></pre><h2 id="Data"><a class="docs-heading-anchor" href="#Data">Data</a><a id="Data-1"></a><a class="docs-heading-anchor-permalink" href="#Data" title="Permalink"></a></h2><p>Suppose that the data we would like to filter are contained in text files. <a href="../u.txt"><code>u.txt</code></a> contains the control inputs, and <a href="../y.txt"><code>y.txt</code></a> contains the measurements. The code that generated this data can be found in the <a href="#Appendix">appendix below</a>.</p><pre><code class="language-julia hljs">ys = vec(readdlm(&quot;y.txt&quot;));
us = vec(readdlm(&quot;u.txt&quot;));</code></pre><h2 id="Filtering"><a class="docs-heading-anchor" href="#Filtering">Filtering</a><a id="Filtering-1"></a><a class="docs-heading-anchor-permalink" href="#Filtering" title="Permalink"></a></h2><p>We can use an SIR particle filter to get a better estimate of the state. Note that we start with an initial belief consisting of particles with zero velocity and position uniformly distributed in <span>$[-5, 5]$</span>.</p><pre><code class="language-julia hljs">n = 10_000

fil = BootstrapFilter(f, g, n)

# construct initial belief
b0 = ParticleCollection([[10.0 * (rand() - 0.5), 0.0] for i in 1:n])

bs = runfilter(fil, b0, us, ys)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">100-element Vector{Any}:
 WeightedParticleBelief{Vector{Float64}}([[-1.3641680677146995, 0.2758812396097727], [-1.0147989510422417, 0.21278622995997687], [-2.238795479189325, 0.4420809913283983], [0.16969370797796146, -0.03530179609495274], [1.8421331846572464, -0.38578760012902014], [4.883007722018519, -0.9763992754345772], [-2.9006392023733154, 0.5563244120292631], [1.542411073820259, -0.2972309460413795], [1.8872128176261693, -0.38189486449443755], [4.520159238186515, -0.8772300214996509]  …  [-0.8590507012683213, 0.16317065645950746], [0.11829279728818753, -0.055582857908929785], [1.4626261125140105, -0.3036793547797885], [-0.4377066536112828, 0.06309929231716926], [3.711429702752893, -0.7322414853851567], [-2.8507397192909067, 0.5604705340014863], [-3.9042194507394603, 0.7822584726564772], [-4.659836425317213, 0.9296931065070231], [-4.065690461223564, 0.8394386838477585], [-0.08676329707469455, 0.025050724745470977]], [0.0003571661175030418, 0.0012440225081302527, 9.196903303423185e-6, 0.034494196775663524, 0.3447690623352382, 0.017501510177897837, 3.469209690637453e-7, 0.2803473681310155, 0.35291017742733, 0.0406013308509526  …  0.002086167168354387, 0.03074523929026464, 0.2613416231560795, 0.007480707313607742, 0.16495148682789307, 4.510024374523245e-7, 1.0445232837075103e-9, 6.790768005227851e-12, 3.735953593006891e-10, 0.018924228042641777], 989.2955519256235, nothing, nothing)
 WeightedParticleBelief{Vector{Float64}}([[1.7649756646314423, -0.5721517750374131], [1.7649756646314423, -0.6526959936935948], [1.7649756646314423, -0.6149450694510439], [1.7649756646314423, -0.5939042424315095], [1.4829648846119832, -0.5535794023024261], [1.4829648846119832, -0.5238061689088838], [1.4829648846119832, -0.5536119991508672], [1.8108338447272818, -0.5964062833417356], [1.8108338447272818, -0.6237391824879686], [1.8108338447272818, -0.5852415592562752]  …  [0.4818258091611192, -0.2079673594352293], [3.7468497345735607, 0.21679257377997774], [4.268538061354166, 0.9076191751882816], [3.2951590748344675, -0.21879831847151232], [3.2951590748344675, -0.15801205214289604], [1.4018902415580528, -0.5600973659265042], [1.4018902415580528, -0.5315073599007522], [1.4018902415580528, -0.5582228374132463], [3.5649814056758617, -0.01122382346338513], [3.5649814056758617, 0.005025291670611387]], [0.3967170416770943, 0.3967170416770943, 0.3967170416770943, 0.3967170416770943, 0.370047161325978, 0.370047161325978, 0.370047161325978, 0.39822697750981173, 0.39822697750981173, 0.39822697750981173  …  0.15205921298619654, 0.06864375835116328, 0.02251334722140376, 0.14465295517259155, 0.14465295517259155, 0.3574176070698956, 0.3574176070698956, 0.3574176070698956, 0.09497335659090662, 0.09497335659090662], 2750.9246454581235, nothing, nothing)
 WeightedParticleBelief{Vector{Float64}}([[1.6505453096239597, -0.7606168645997312], [1.6344364658927233, -0.7793724777709308], [1.6344364658927233, -0.8138643534046084], [1.6419866507412335, -0.7489620867257425], [1.6461948161451403, -0.7516348707351247], [1.6461948161451403, -0.7575382412286198], [1.3722490041514979, -0.76571938592347], [1.3782036508302065, -0.7468293636841119], [1.3722424847818098, -0.7495763483836553], [1.3722424847818098, -0.7416585900020742]  …  [1.9077708084719436, -0.7411352670116147], [1.9077708084719436, -0.7153576118450922], [1.9105391900642, -0.6677618402624649], [0.44023233727407335, -0.3334418897064926], [3.251399411140165, -0.5193304379794217], [1.289870768372752, -0.7564576946601498], [1.289870768372752, -0.7504814524185637], [1.2955887695779023, -0.7016149932579492], [1.2902456740754036, -0.770494393322924], [3.565986464009984, -0.7244920793979422]], [0.3600990119188436, 0.35743656517273026, 0.35743656517273026, 0.35869357815542274, 0.3593872119932594, 0.3593872119932594, 0.30542030756229205, 0.30674708311046583, 0.3054188521735486, 0.3054188521735486  …  0.3913980050112459, 0.3913980050112459, 0.39160829188163043, 0.10009545560952632, 0.20635735142384362, 0.2865987748808397, 0.2865987748808397, 0.28792999535516806, 0.28668615579005136, 0.1368534940502096], 3230.598119251217, nothing, nothing)
 WeightedParticleBelief{Vector{Float64}}([[1.4984219367040135, -0.8883604054667762], [1.478561970338537, -0.8946756233200129], [1.4716635952118016, -0.9278343280379766], [1.492194233396085, -0.8629769311832566], [1.4958678419981153, -0.8689833952978437], [1.4946871678994162, -0.8653406855041459], [1.2191051269668038, -0.9208669994009457], [1.2288377780933841, -0.9249164670168645], [1.2223272151050788, -0.914410529740025], [1.2239107667813949, -0.9146834208555391]  …  [1.7595437550696207, -0.8135016179746882], [1.7646992861029251, -0.773609495314016], [1.7769868220117069, -0.7588338989087944], [0.37354395933277484, -0.46960357708096645], [3.147533323544281, -0.3823851895909377], [1.138579229440722, -0.9486775760359174], [1.139774477889039, -0.8784977905785147], [1.1552657709263123, -0.8833699741242598], [1.1361467954108186, -0.9418056198401119], [3.4210880481303954, -0.10374773587320274]], [0.04614259581509945, 0.04807631087228588, 0.048762280459177756, 0.046742434106553044, 0.046387881289976, 0.04650160645269959, 0.07927193433232867, 0.07789330615378359, 0.07881367198981297, 0.07858912378268938  …  0.02592686375643733, 0.02561586292850685, 0.024886923980870286, 0.2535333867677664, 0.0003854499546221969, 0.09132334748821341, 0.09113603379527094, 0.08873131856331794, 0.0917053322729105, 0.00013397921211242411], 456.56044080308027, nothing, nothing)
 WeightedParticleBelief{Vector{Float64}}([[1.3207498556106583, -1.0199239898065047], [1.2996268456745346, -1.016671530636578], [1.2996268456745346, -0.9970526377980587], [1.2860967296042063, -1.0473196817551909], [1.3195988471594335, -0.9977794586254998], [1.3220711629385464, -0.9907612972321268], [1.3216190307985871, -1.014506475205972], [1.0349317270866147, -1.0709323860004312], [1.0438544846900113, -1.0887478427409891], [1.0438544846900113, -1.0807371634399987]  …  [0.27962324391658155, -0.6273883109315608], [0.27962324391658155, -0.6017725191994909], [0.27962324391658155, -0.609065788201844], [0.9488437142335385, -1.071886581880315], [0.9488437142335385, -1.1292014331264033], [0.9640749197733361, -1.0839954461014927], [0.9640749197733361, -1.0468266373153412], [0.9785917761014604, -1.1039226042320118], [0.9477856714427962, -1.1149392150486348], [0.9477856714427962, -1.1386970036663289]], [0.3110126083897547, 0.30634274013064045, 0.30634274013064045, 0.30331729908497024, 0.31075989157061285, 0.31130246115871096, 0.3112033085177418, 0.24403090919661782, 0.246189575734886, 0.246189575734886  …  0.08676227907014514, 0.08676227907014514, 0.08676227907014514, 0.22323706887490707, 0.22323706887490707, 0.2269049134710204, 0.2269049134710204, 0.2304070549821509, 0.2229825722770372, 0.2229825722770372], 2181.2415074240826, nothing, nothing)
 WeightedParticleBelief{Vector{Float64}}([[1.1167650576493573, -1.1190713552658156], [1.096292539547219, -1.2046935656350786], [1.096292539547219, -1.1957746308820272], [1.100216318114923, -1.1541736252601973], [1.076632793253168, -1.2004765479239237], [1.076632793253168, -1.174101345555606], [1.1200429554343336, -1.1332161815306687], [1.123918903492121, -1.1154541969828526], [1.1187177357573928, -1.1472855069900096], [1.1187177357573928, -1.132944847837505]  …  [0.1602342006579921, -0.7431543695942492], [0.1611439139423355, -0.7323798726486919], [0.15781008627621274, -0.7726285432811201], [0.7344663978574755, -1.2742303956887098], [0.7230034276082579, -1.3351689727948135], [0.7472758305530376, -1.3004708132163014], [0.7547095923102679, -1.2480188242780588], [0.7578072552550581, -1.3053001518794631], [0.7247978284330693, -1.3254482490806914], [0.7200462707095304, -1.352537702134277]], [0.16348157514678488, 0.15903821648604397, 0.15903821648604397, 0.15988556722980876, 0.1548238856832698, 0.1548238856832698, 0.1641980595508861, 0.16504703065318005, 0.16390822714231312, 0.16390822714231312  …  0.028833468923952374, 0.028893646712993815, 0.02867360847206125, 0.09119207838183839, 0.08940783982869273, 0.09321356371881559, 0.09440008464222721, 0.09489740936997804, 0.0896855983423929, 0.08895134698539377], 1426.7754656219315, nothing, nothing)
 WeightedParticleBelief{Vector{Float64}}([[0.8929507865961942, -1.2327416016866757], [0.8553538264202032, -1.3899102421566105], [0.8571376133708135, -1.3505043020267298], [0.8693815930628834, -1.3264137380263095], [0.8693815930628834, -1.3291166057303738], [0.8365374836683833, -1.3700453092257874], [0.8418125241420469, -1.3862643487626456], [0.8933997191281999, -1.3281838009874476], [0.9008280640955506, -1.282825702686875], [0.8892606343593908, -1.3247590656132269]  …  [1.2139676936758181, -1.1161500574950953], [1.2139676936758181, -1.1254291488002748], [1.214116876218285, -1.141230407883251], [1.2585266011583416, -1.0626380134115556], [1.2585266011583416, -1.1157194451104298], [0.0032843776199887043, -0.9339420600613173], [0.45596963304929516, -1.5523669123877615], [0.5051058274546562, -1.4820048419345966], [0.49674722487916545, -1.5406148834738513], [0.449538730282675, -1.6157242235447797]], [0.39868042251594943, 0.39894191201729556, 0.39894224440333703, 0.3989102668958363, 0.3989102668958363, 0.3988610952665371, 0.3988979966408866, 0.39867389649697754, 0.3985542671275399, 0.39873102428512736  …  0.3742788903724767, 0.3742788903724767, 0.37425893909919455, 0.36800244411485855, 0.36800244411485855, 0.27717434458140583, 0.3681605806526174, 0.3750288719011233, 0.37391523924364584, 0.3672054074739054], 3470.6741779867352, nothing, nothing)
 WeightedParticleBelief{Vector{Float64}}([[0.646402466258859, -1.4072954892707965], [0.5773717779888811, -1.606147788289717], [0.5870367529654675, -1.5929650388191445], [0.6040988454576215, -1.5790750620223695], [0.6035582719168087, -1.54858697331475], [0.5625284218232258, -1.6138253144289405], [0.5645596543895177, -1.6205182717067999], [0.6277629589307103, -1.533427185157598], [0.6442629235581756, -1.5266803288554918], [0.6243088212367455, -1.549827496303395]  …  [0.990737682176799, -1.256571614699035], [0.9888818639157632, -1.2642556968039307], [0.9858707946416349, -1.3130028617683118], [1.0459989984760305, -1.1987661071539903], [1.0353827121362555, -1.2777494835092622], [-0.18350403439227478, -1.0944671078104995], [0.14549625057174287, -1.8634783630728007], [0.20870485906773684, -1.7564394815134716], [0.18862424818439516, -1.8315542908748355], [0.126393885573719, -1.8976596123843013]], [0.3399180253297441, 0.32611775172869595, 0.3281097791480103, 0.3315805455422477, 0.3314715012772989, 0.32302318237550137, 0.3234491255981727, 0.33629305758049527, 0.3395059474515492, 0.3356127566516075  …  0.3892706459899491, 0.3891099586531642, 0.38884653500320976, 0.39346456449769157, 0.39274844005539433, 0.1506111591651464, 0.225833101194712, 0.24110412326768357, 0.2362462617519294, 0.22123723183531632], 3213.0053162267764, nothing, nothing)
 WeightedParticleBelief{Vector{Float64}}([[0.3649433684046997, -1.6755465352901564], [0.25614222033093764, -1.902871160912161], [0.2684437452016386, -1.8702257699440503], [0.2882838330531476, -1.844193003390051], [0.29384087725385866, -1.7949602732742407], [0.23976335893743772, -1.896797020656756], [0.2404560000481577, -1.9075185091830382], [0.3210775218991907, -1.7870099898629463], [0.3389268577870772, -1.7328388657019724], [0.31434332197606646, -1.8314981171217912]  …  [0.739423359236992, -1.4723065584350552], [0.7360307245549771, -1.463078403933305], [0.7232702222879726, -1.5033659944467834], [0.8062457770452325, -1.3778906684421088], [0.7798328154344031, -1.4486832366255966], [-0.4023974559543747, -1.2599009124039773], [-0.2271994220428173, -2.1943064884884818], [-0.14258303723495752, -2.0440247974557875], [-0.17768660999057195, -2.1554827633226816], [-0.2531380369031413, -2.2372813604766453]], [0.24217408697048204, 0.26839175813432503, 0.26544808035871936, 0.2606852133789925, 0.2593482586913143, 0.2722978817797682, 0.2721330297270166, 0.25278105245148264, 0.24846774815184527, 0.25440670133085297  …  0.15530236234172085, 0.15602690240547604, 0.15876610275989184, 0.14136587786081548, 0.1467968197739215, 0.38836545213723905, 0.3672289228140002, 0.3535288759340616, 0.35946151411696187, 0.3710016339470355], 2120.7831782131298, nothing, nothing)
 WeightedParticleBelief{Vector{Float64}}([[0.029834061346668383, -1.9435847737648517], [-0.12443201185149455, -2.2209546668232067], [-0.12443201185149455, -2.219735133718739], [-0.1056014087871715, -2.1926923837572523], [-0.08055476762486263, -2.159191934412165], [-0.06515117740098952, -2.141834982564272], [-0.1395960451939135, -2.233228434127574], [-0.14104770178844994, -2.229232415773582], [-0.14104770178844994, -2.2038810767169466], [-0.036324476073398615, -2.1541107784332656]  …  [0.5306676433568107, -1.5966512834483533], [-0.6543776384351702, -1.3664021670435789], [-0.6543776384351702, -1.3648278095829047], [-0.6660607197405137, -2.486386048001501], [-0.6660607197405137, -2.4947150509854827], [-0.551387996726115, -2.3498407751214403], [-0.551387996726115, -2.3582097758048635], [-0.6087831626551083, -2.4450614988464596], [-0.7005943089984703, -2.5357642915368412], [-0.7005943089984703, -2.523078321473527]], [0.38966704145592507, 0.37238653362993634, 0.37238653362993634, 0.3749319273015937, 0.3781367059142763, 0.380002817271013, 0.37025388415985755, 0.37004590395719805, 0.37004590395719805, 0.38327546998292433  …  0.3831817102877683, 0.2658175501290367, 0.2658175501290367, 0.2630157964367442, 0.2630157964367442, 0.29012519299570455, 0.29012519299570455, 0.2766786525614108, 0.25470232758400985, 0.25470232758400985], 3185.827397577029, nothing, nothing)
 ⋮
 WeightedParticleBelief{Vector{Float64}}([[1.2636258548612704, -1.0972196588320682], [1.298590235095328, -1.0914991843841224], [1.226126119759145, -1.1479883081262168], [1.2016353765854604, -1.134237022666127], [1.2868116446277404, -1.0919643219653852], [1.2722465058169286, -1.141253798119118], [1.3430832692903687, -1.0519784974920492], [1.2522302005472197, -1.0919448816101098], [1.236661512230921, -1.075113409005437], [1.2327353633761835, -1.0937141545221702]  …  [1.1250744211450285, -1.1677161292451195], [0.8780911531698233, -1.3473246098077127], [0.946206163987924, -1.298341765379732], [0.9804507068311624, -1.280946142075676], [1.1439052057450647, -1.1654265117222846], [1.0054823205096317, -1.2779942060002918], [1.0244186406563156, -1.27005253374291], [1.0597518763155183, -1.198602317092392], [0.9710524141382154, -1.223406311499852], [1.0025102745087304, -1.2489560656168956]], [0.3988668253107102, 0.3988942728186571, 0.39829586018766494, 0.397621461592145, 0.3989394969119488, 0.39891888714895685, 0.39822465856011463, 0.39875253499841967, 0.3985127885489444, 0.39843710307489366  …  0.393993527962538, 0.36753198457454, 0.3769362494239143, 0.3810862340515113, 0.3950974640012819, 0.38386372099566723, 0.385817673207061, 0.3891169318178456, 0.37998712089475695, 0.383545461856372], 3964.256941831096, nothing, nothing)
 WeightedParticleBelief{Vector{Float64}}([[1.0441819230948568, -1.2768919546716222], [1.0802903982185035, -1.2613874908219591], [0.9965284581339018, -1.2554709146785148], [0.974787972052235, -1.265131832991588], [1.0684187802346634, -1.2672261508155893], [1.0439957461931049, -1.2546757182455541], [1.1326875697919587, -1.1812668358359881], [1.0338412242251978, -1.2581426781579104], [1.0216388304298336, -1.226609629050714], [1.0139925324717494, -1.2307280800565021]  …  [0.8915311952960047, -1.321443254192252], [0.6086262312082809, -1.5365906665198796], [0.6865378109119775, -1.5290490209589462], [0.7242614784160273, -1.477783329115805], [0.9108199034006078, -1.318418477809261], [0.7498834793095733, -1.503007355945734], [0.7704081339077335, -1.4862448707324663], [0.8200314128970398, -1.4105698495219388], [0.726371151838245, -1.4225583089910707], [0.7527190613853513, -1.407255195752673]], [0.39754077226845425, 0.3960800128046322, 0.3986803609903264, 0.3989003336157078, 0.3966167382606649, 0.39754697479277457, 0.3930573899576426, 0.397864532141309, 0.39819214846233003, 0.3983673467289908  …  0.39800044351373043, 0.375021881469025, 0.3842708537760775, 0.3879835370448271, 0.39845448980266845, 0.39020884308511616, 0.3918150446494374, 0.3950376360453291, 0.3881759119424412, 0.3904401470140911], 3966.715908311743, nothing, nothing)
 WeightedParticleBelief{Vector{Float64}}([[0.7888035321605323, -1.476699245605257], [0.8280129000541117, -1.4306797537910074], [0.7454342751981988, -1.4646420846311523], [0.7217616054539173, -1.485047760113743], [0.8149735500715456, -1.448571945794578], [0.793060602543994, -1.4538195329801697], [0.8964342026247611, -1.347037990344149], [0.7822126885936156, -1.4557213314696478], [0.7763169046196908, -1.4429815558368169], [0.7678469164604489, -1.4197191658102173]  …  [0.6272425444575542, -1.5502996063254362], [0.3013080979043049, -1.8059800716203336], [0.38072800672018825, -1.7906252528759068], [0.4287048125928663, -1.760315874867782], [0.6471362078387557, -1.5787798722389397], [0.4492820081204265, -1.7292187499024785], [0.4731591597612403, -1.7230023506716767], [0.5379174429926521, -1.636138942415899], [0.44185949004003083, -1.6662210281347067], [0.4712680222348166, -1.6423067549733392]], [0.22413307916786362, 0.23359206126134385, 0.21373297636093366, 0.20809604021169198, 0.23044223281460816, 0.2251579986545389, 0.2501415554130694, 0.22254752688763205, 0.2211305514467558, 0.21909734527968053  …  0.18599071582939578, 0.11790947548173523, 0.13305536416218355, 0.14269542637703225, 0.19058069988403678, 0.14693751131089638, 0.15193755697825564, 0.16589483622371312, 0.14540007511327632, 0.15153856002639354], 2117.342975524165, nothing, nothing)
 WeightedParticleBelief{Vector{Float64}}([[0.4934636830394809, -1.7257684109262947], [0.5418769492959101, -1.658358174473144], [0.4525058582719684, -1.7063828102258214], [0.4247520534311687, -1.7810889024785603], [0.52525916091263, -1.6656098931121786], [0.50229669594796, -1.6845755308626509], [0.6270266045559314, -1.5596656312051618], [0.491068422299686, -1.701519335168953], [0.48772059345232743, -1.6587132239371563], [0.4839030832984054, -1.684678577108082]  …  [0.317182623192467, -1.8409970564329496], [-0.05988791641976182, -2.1360874156778253], [0.022602956145006847, -2.132422253028081], [0.07664163761930987, -2.0899754339348973], [0.3313802333909677, -1.846503679083853], [0.1034382581399308, -2.0135455240260045], [0.12855868962690492, -2.0393574776103716], [0.2106896545094723, -1.934492338978294], [0.10861528441308949, -1.9832065924229751], [0.14280667124014873, -1.9588168225916471]], [0.09443023587144743, 0.08687776284449206, 0.1011448182603941, 0.10586311090184244, 0.08942311698911272, 0.09302118044905326, 0.074604648210111, 0.09481472166563346, 0.09535382099206186, 0.09597098171872197  …  0.12540919089788938, 0.2072949390691558, 0.18798244916150444, 0.17566804470674197, 0.12271710739595407, 0.1696802935776966, 0.16414549566842837, 0.14663160517415852, 0.1685332723722405, 0.16104168002333394], 1050.815283325077, nothing, nothing)
 WeightedParticleBelief{Vector{Float64}}([[0.1483100008542219, -2.0111584257848163], [0.21020531440128132, -1.9766179629456202], [0.11122929622680405, -2.011253581167129], [0.06853427293545661, -2.1122787866524835], [0.19213718229019427, -1.9405414388182203], [0.16538158977542983, -1.9953874231927187], [0.31509347831489903, -1.8076824803411264], [0.15076455526589538, -2.042621424650473], [0.15597794866489617, -1.9461851571371822], [0.146967367876789, -2.0115506772466274]  …  [-0.05101678809412297, -2.193509792853989], [-0.4871053995553269, -2.4673571013902036], [-0.4038814944606094, -2.491432810840671], [-0.34135344916766963, -2.4427217138639277], [-0.03792050242580286, -2.141886929291709], [-0.29927084666527015, -2.3631057601402503], [-0.27931280589516944, -2.3801379910527487], [-0.17620881328618654, -2.234880116204048], [-0.28802603407150557, -2.307870393488259], [-0.2489566932781807, -2.2701187809247663]], [0.15512963561018694, 0.14220556231103748, 0.16312865601886944, 0.1725568498682495, 0.14592057555308688, 0.15150996083634566, 0.12164625773674989, 0.15460669689978945, 0.1534987649277976, 0.1554160331355821  …  0.20000855356596778, 0.3036060874929614, 0.28450837453567995, 0.2697224937226516, 0.19693714861986192, 0.25963428896648943, 0.25482484257415666, 0.22989888810436535, 0.25692606881373575, 0.2474908705948723], 1687.4009388565319, nothing, nothing)
 WeightedParticleBelief{Vector{Float64}}([[-0.25392168430274137, -2.36613073351447], [-0.18511827818784277, -2.303074709799289], [-0.2910214200066218, -2.3208821235898878], [-0.3539214843950401, -2.429247844914441], [-0.1959711054734498, -2.2772731003175917], [-0.23369589486311393, -2.3437700321790347], [-0.046443017753326266, -2.1281134370511072], [-0.25775972966419924, -2.4131810046847466], [-0.23325908276254032, -2.3084165833862453], [-0.2553427675725365, -2.3448669845284598]  …  [-0.48971874666492077, -2.502799863449906], [-0.9805768198333676, -2.6984655153372388], [-0.9021680566287437, -2.7264840013166047], [-0.8298977919404552, -2.721323428466833], [-0.46629788828414465, -2.4898362722559844], [-0.7718919986933203, -2.6344594146349922], [-0.7553404041057192, -2.7091576440738505], [-0.6231848365269962, -2.5422455349785618], [-0.7496001127691574, -2.6021831199630743], [-0.702980449463134, -2.538877287119774]], [0.3933184189256987, 0.3878655381079505, 0.3955126869314659, 0.39800722386832477, 0.388842866860517, 0.3919000332187798, 0.3717175488682926, 0.393569975587616, 0.39186768869630156, 0.39341221773476753  …  0.3980400952495497, 0.34139898837117816, 0.35557692710437466, 0.3671612197581308, 0.3985585742793656, 0.3753107310424724, 0.3774361831701633, 0.3909834170470173, 0.3781519278230686, 0.3835469294263308], 3893.871261493436, nothing, nothing)
 WeightedParticleBelief{Vector{Float64}}([[-0.7271478310056354, -2.6705235464061845], [-0.6457332201477006, -2.635873949772478], [-0.7551978447245994, -2.5786770286864726], [-0.8397710533779283, -2.7134513223030883], [-0.6514257255369682, -2.5688030653850786], [-0.7024499012989209, -2.656802084984011], [-0.47206570516354773, -2.430216205418453], [-0.7403959306011486, -2.73334339530031], [-0.6949423994397894, -2.6399256985782955], [-0.7243161644782284, -2.6499956300325156]  …  [-0.990278719354902, -2.706599430425948], [-1.5202699229008154, -2.4867545715626753], [-1.4474648568920645, -2.6056303034049817], [-1.374162477633822, -2.703917272682741], [-0.9642651427353415, -2.6733934051680865], [-1.2987838816203188, -2.6515504949537845], [-1.2971719329204894, -2.783619144606819], [-1.1316339435227085, -2.642655373315571], [-1.2700367367617722, -2.67289671298722], [-1.2107559068870888, -2.590624331887916]], [0.028095465377076752, 0.02321387304043169, 0.0299590020882834, 0.03618704707130269, 0.023530804428084865, 0.026533547600679715, 0.01511180440243169, 0.028963554749244492, 0.026073050974229756, 0.027912685096110404  …  0.049755881122493704, 0.12749741431922704, 0.11391787735144115, 0.101163221393988, 0.047167792502148954, 0.08903466347737576, 0.08878632935847472, 0.06573057614155099, 0.08467534947059194, 0.0761490807690461], 359.9639269192171, nothing, nothing)
 WeightedParticleBelief{Vector{Float64}}([[-1.2612525402868724, -2.727915519678943], [-1.270933250461894, -2.6230540230813175], [-1.3824613178385459, -2.694294230110978], [-1.1651863386139838, -2.6893510977184523], [-1.2338103182957232, -2.780529671279434], [-1.2870646096612106, -2.7860460620809366], [-1.2229275391554486, -2.717638730381145], [-1.3608348452953167, -2.7344324268891826], [-1.3173884733701284, -2.660812473884008], [-1.4732086557741055, -2.6010740854193104]  …  [-1.8290939806110758, -2.119241489475582], [-1.8538957618418532, -2.2109117817901627], [-1.8538957618418532, -2.226517473192914], [-1.8538957618418532, -2.2258320771912135], [-1.6601650181858227, -2.2807132922430746], [-1.8046160793592163, -2.128195176697871], [-1.8046160793592163, -2.1653032223233035], [-1.8046160793592163, -2.1847203581966537], [-1.728880773264672, -2.1577345834356563], [-1.728880773264672, -2.1786925550188263]], [0.05013362594892963, 0.051129521366887275, 0.06370194834381201, 0.04103466295516529, 0.047390564917518134, 0.052822166383218475, 0.046335113325683096, 0.061102661973216586, 0.05611761791539705, 0.07548437079652591  …  0.13564036178367425, 0.14062972243691438, 0.14062972243691438, 0.14062972243691438, 0.10433443662945639, 0.13081082674152522, 0.13081082674152522, 0.13081082674152522, 0.11648751355305419, 0.11648751355305419], 783.1754945494214, nothing, nothing)
 WeightedParticleBelief{Vector{Float64}}([[-1.7955440550781576, -2.126958685351762], [-1.9213201638607416, -2.0196693207468046], [-1.7899162525516101, -2.3174064128638134], [-1.844273822077398, -2.251607614487541], [-1.9077213306731533, -2.1459177332489947], [-1.84955096814693, -2.0607619619694484], [-1.9934234728579676, -1.815006471199673], [-1.919848675591401, -1.8665488978289981], [-1.9191001209889051, -1.9264699248777997], [-2.0275169650062286, -1.757598080836845]  …  [-2.1163076766344378, -1.2939486295695923], [-2.1163076766344378, -1.32898288073632], [-2.2302551146987906, -1.0259068242807532], [-2.237676723823877, -1.0191574900074725], [-2.237676723823877, -0.9936228892649006], [-2.241560150998547, -1.0322006633398082], [-2.241560150998547, -1.0515549295565227], [-2.1604276899518036, -1.1436303903659253], [-2.1646192842684373, -1.1639375459303996], [-2.1646192842684373, -1.1292984294779498]], [0.20589599661160346, 0.17676080633800065, 0.20722978795855548, 0.19444247417168187, 0.17983798403929027, 0.19321347449144635, 0.16080590168228298, 0.17709280181072012, 0.17726178175471474, 0.1534933373083735  …  0.13523226863284518, 0.13523226863284518, 0.1136237640923017, 0.11229201635469145, 0.11229201635469145, 0.11159894928928285, 0.11159894928928285, 0.12661144485941042, 0.12580884253264324, 0.12580884253264324], 1500.832380307461, nothing, nothing)</code></pre><h2 id="Plotting-the-Results"><a class="docs-heading-anchor" href="#Plotting-the-Results">Plotting the Results</a><a id="Plotting-the-Results-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-the-Results" title="Permalink"></a></h2><p>We can now plot the observations, the smoothed estimate of the position (the mean of the belief at every time step), and the true state. Note that the estimated position is much closer to the true position than the noisy measurements.</p><pre><code class="language-julia hljs">xmat = readdlm(&quot;x.txt&quot;);

plot_data = [(; t, x1=x[1], x2=x[2], y, b_mean=mean(b)[1]) for (t, (x, y, b)) in enumerate(zip(eachslice(xmat; dims=1), ys, bs))]

plot_data |&gt; @vlplot(x = :t, width = 700) +
             @vlplot(:line, y = :x1, color = {datum = &quot;True State&quot;}) +
             @vlplot(:point, y = :y, color = {datum = &quot;Observation&quot;}) +
             @vlplot(:line, y = :b_mean, color = {datum = &quot;Mean Belief&quot;})</code></pre><img src="19e16710.svg" alt="Example block output"/><h2 id="Appendix"><a class="docs-heading-anchor" href="#Appendix">Appendix</a><a id="Appendix-1"></a><a class="docs-heading-anchor-permalink" href="#Appendix" title="Permalink"></a></h2><h3 id="Code-for-Generating-Data"><a class="docs-heading-anchor" href="#Code-for-Generating-Data">Code for Generating Data</a><a id="Code-for-Generating-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Code-for-Generating-Data" title="Permalink"></a></h3><p>The following code can be used to generate the data in the text files:</p><pre><code class="language-julia hljs">rng = MersenneTwister(1)

k = 100
h(x, rng) = x[1] + sigma*randn(rng)

x = [3.0, 0.0]
xs = Array{typeof(x)}(undef, k)
us = zeros(k)
ys = zeros(k)
for t in 1:k
    x = f(x, us[t], rng)
    ys[t] = h(x, rng)
    xs[t] = x
end

using DelimitedFiles
writedlm(&quot;x.txt&quot;, xs)
writedlm(&quot;y.txt&quot;, ys)
writedlm(&quot;u.txt&quot;, us)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../sampling/">« Sampling</a><a class="docs-footer-nextpage" href="../example-feedback/">Example: Feedback Control »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.2 on <span class="colophon-date" title="Saturday 26 April 2025 16:31">Saturday 26 April 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
